<?xml version="1.0" encoding="UTF-8"?>

<map:sitemap xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://apache.org/cocoon/sitemap/1.0 http://cocoon.apache.org/schema/sitemap/cocoon-sitemap-1.0.xsd"
 xmlns:map="http://apache.org/cocoon/sitemap/1.0">

  <map:flow language="spring-apples"/>

  <map:pipelines>
    <map:pipeline>

      <!-- pattern to match for "", when users don't define a URL -->
      <map:match pattern="">
        <map:generate src="cocoon:/empty"/>
        <!-- apply styling -->
        <map:serialize type="servletService">
          <map:parameter name="service" value="servlet:skin:/sublima-styling"/>
        </map:serialize>
      </map:match>

      <!-- So that we have a "home" link on the site -->
      <map:match pattern="home">
          <map:redirect-to uri="cocoon:/"/>
      </map:match>

    </map:pipeline>

    <map:pipeline>
        <map:match pattern="empty">
            <map:generate src="templates/empty-page.jx.xml" type="jx"/>
            <map:serialize type="xml"/>
        </map:match>
    </map:pipeline>

    <!-- Pipeline for feedback (tips and feedback on resources) -->
    <map:pipeline>

       <map:match pattern="tips">
         <map:generate src="templates/tips.jx.xml" type="jx"/>
         <!-- apply styling -->
         <map:serialize type="servletService">
           <map:parameter name="service" value="servlet:skin:/sublima-styling"/>
         </map:serialize>
         <map:serialize type="xml"/>
       </map:match>

       <map:match pattern="sendtips">
        <map:call function="com.computas.sublima.app.controller.Feedback">
          <map:parameter name="mode" value="sendtips"/>
        </map:call>
       </map:match>

      <map:match pattern="takk">
        <map:generate src="templates/takktips.jx.xml" type="jx"/>
         <!-- apply styling -->
         <map:serialize type="servletService">
           <map:parameter name="service" value="servlet:skin:/sublima-styling"/>
         </map:serialize>
         <map:serialize type="xml"/>
      </map:match>

    </map:pipeline>

    <map:pipeline>

      <map:match pattern="advancedsearch">
        <!--map:call function="com.computas.sublima.app.controller.Search">
          <map:parameter name="mode" value="advancedsearch"/>
        </map:call-->
        <map:generate src="templates/advancedsearch.jx.xml" type="jx"/>
        <!--map:transform type="servletService">
          <map:parameter name="service" value="servlet:/navigation-and-facets"/>
        </map:transform-->
        <!-- apply styling -->
        <map:serialize type="servletService">
          <map:parameter name="service" value="servlet:skin:/sublima-styling"/>
        </map:serialize>
        <map:serialize type="xml"/>
       </map:match>

      <map:match pattern="search-result">
        <map:call function="com.computas.sublima.app.controller.Search">
          <map:parameter name="mode" value="search-result"/>
        </map:call>
      </map:match>

      <map:match pattern="topic-instance/*">
        <map:call function="com.computas.sublima.app.controller.Search">
          <map:parameter name="mode" value="topic-instance"/>
            <map:parameter name="topic" value="{1}"/>
            <map:parameter name="interface-language" value="no"/>
        </map:call>
      </map:match>

      <map:match pattern="resource/*">
        <map:call function="com.computas.sublima.app.controller.Search">
          <map:parameter name="mode" value="resource"/>
          <map:parameter name="name" value="{1}"/>
          <map:parameter name="interface-language" value="no"/>
        </map:call>
      </map:match>

      <map:match pattern="freetext-result">
        <map:call function="com.computas.sublima.app.controller.Search">
          <map:parameter name="mode" value="freetext-result"/>
        </map:call>
      </map:match>

    </map:pipeline>
    
    <map:pipeline internal-only="true">

      <map:match pattern="xhtml/*">
        <map:generate src="templates/{1}.jx.xml" type="jx"/>
        <map:serialize type="xhtml"/>
      </map:match>

      <map:match pattern="xml/*">
        <map:generate src="templates/{1}.jx.xml" type="jx"/>
        <!-- render the result and add facets and navigation -->
        <map:transform type="servletService">
          <map:parameter name="service" value="servlet:/navigation-and-facets"/>
        </map:transform>
        <!-- apply styling -->
        <map:serialize type="servletService">
          <map:parameter name="service" value="servlet:skin:/sublima-styling"/>
        </map:serialize>
      </map:match>

    </map:pipeline>
    
    <map:pipeline>

      <map:match pattern="navigation-and-facets">
        <map:generate src="service-consumer:"/>
        <map:transform type="navigation-facets"/>
        <map:serialize type="xml"/>
      </map:match>
      
    </map:pipeline>
     
  </map:pipelines>

</map:sitemap>